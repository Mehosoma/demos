THREE.OBJLoader=function(){function d(){var k={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(m,n){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=m,void(this.object.fromDeclaration=!1!==n);var o=this.object&&'function'==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&'function'==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:m||'',fromDeclaration:!1!==n,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(q,r){var s=this._finalize(!1);s&&(s.inherited||0>=s.groupCount)&&this.materials.splice(s.index,1);var t={index:this.materials.length,name:q||'',mtllib:Array.isArray(r)&&0<r.length?r[r.length-1]:'',smooth:void 0===s?this.smooth:s.smooth,groupStart:void 0===s?0:s.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(u){var v={index:'number'==typeof u?u:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return v.clone=this.clone.bind(v),v}};return this.materials.push(t),t},currentMaterial:function(){return 0<this.materials.length?this.materials[this.materials.length-1]:void 0},_finalize:function(q){var r=this.currentMaterial();if(r&&-1===r.groupEnd&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),q&&1<this.materials.length)for(var s=this.materials.length-1;0<=s;s--)0>=this.materials[s].groupCount&&this.materials.splice(s,1);return q&&0===this.materials.length&&this.materials.push({name:'',smooth:this.smooth}),r}},o&&o.name&&'function'==typeof o.clone){var p=o.clone(0);p.inherited=!0,this.object.materials.push(p)}this.objects.push(this.object)},finalize:function(){this.object&&'function'==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(m,n){var o=parseInt(m,10);return 3*(0<=o?o-1:o+n/3)},parseNormalIndex:function(m,n){var o=parseInt(m,10);return 3*(0<=o?o-1:o+n/3)},parseUVIndex:function(m,n){var o=parseInt(m,10);return 2*(0<=o?o-1:o+n/2)},addVertex:function(m,n,o){var p=this.vertices,q=this.object.geometry.vertices;q.push(p[m+0],p[m+1],p[m+2]),q.push(p[n+0],p[n+1],p[n+2]),q.push(p[o+0],p[o+1],p[o+2])},addVertexPoint:function(m){var n=this.vertices,o=this.object.geometry.vertices;o.push(n[m+0],n[m+1],n[m+2])},addVertexLine:function(m){var n=this.vertices,o=this.object.geometry.vertices;o.push(n[m+0],n[m+1],n[m+2])},addNormal:function(m,n,o){var p=this.normals,q=this.object.geometry.normals;q.push(p[m+0],p[m+1],p[m+2]),q.push(p[n+0],p[n+1],p[n+2]),q.push(p[o+0],p[o+1],p[o+2])},addColor:function(m,n,o){var p=this.colors,q=this.object.geometry.colors;q.push(p[m+0],p[m+1],p[m+2]),q.push(p[n+0],p[n+1],p[n+2]),q.push(p[o+0],p[o+1],p[o+2])},addUV:function(m,n,o){var p=this.uvs,q=this.object.geometry.uvs;q.push(p[m+0],p[m+1]),q.push(p[n+0],p[n+1]),q.push(p[o+0],p[o+1])},addUVLine:function(m){var n=this.uvs,o=this.object.geometry.uvs;o.push(n[m+0],n[m+1])},addFace:function(m,n,o,p,q,r,s,t,u){var v=this.vertices.length,w=this.parseVertexIndex(m,v),x=this.parseVertexIndex(n,v),y=this.parseVertexIndex(o,v);if(this.addVertex(w,x,y),void 0!==p&&''!==p){var z=this.uvs.length;w=this.parseUVIndex(p,z),x=this.parseUVIndex(q,z),y=this.parseUVIndex(r,z),this.addUV(w,x,y)}if(void 0!==s&&''!==s){var A=this.normals.length;w=this.parseNormalIndex(s,A),x=s===t?w:this.parseNormalIndex(t,A),y=s===u?w:this.parseNormalIndex(u,A),this.addNormal(w,x,y)}0<this.colors.length&&this.addColor(w,x,y)},addPointGeometry:function(m){this.object.geometry.type='Points';for(var n=this.vertices.length,o=0,p=m.length;o<p;o++)this.addVertexPoint(this.parseVertexIndex(m[o],n))},addLineGeometry:function(m,n){this.object.geometry.type='Line';for(var o=this.vertices.length,p=this.uvs.length,q=0,r=m.length;q<r;q++)this.addVertexLine(this.parseVertexIndex(m[q],o));for(var s=0,r=n.length;s<r;s++)this.addUVLine(this.parseUVIndex(n[s],p))}};return k.startObject('',!1),k}function e(k){this.manager=void 0===k?THREE.DefaultLoadingManager:k,this.materials=null}var f=/^[og]\s*(.+)?/,g=/^mtllib /,h=/^usemtl /;return e.prototype={constructor:e,load:function(k,m,n,o){var p=this,q=new THREE.FileLoader(p.manager);q.setPath(this.path),q.load(k,function(r){m(p.parse(r))},n,o)},setPath:function(k){this.path=k},setMaterials:function(k){return this.materials=k,this},parse:function(k){console.time('OBJLoader');var m=new d;-1!==k.indexOf('\r\n')&&(k=k.replace(/\r\n/g,'\n')),-1!==k.indexOf('\\\n')&&(k=k.replace(/\\\n/g,''));for(var n=k.split('\n'),o='',p='',q=0,r=[],s='function'==typeof''.trimLeft,t=0,u=n.length;t<u;t++)if(o=n[t],o=o.trimLeft(),q=o.length,0!=q&&(p=o.charAt(0),'#'!=p))if('v'==p){var v=o.split(/\s+/);switch(v[0]){case'v':m.vertices.push(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3])),8===v.length&&m.colors.push(parseFloat(v[4]),parseFloat(v[5]),parseFloat(v[6]));break;case'vn':m.normals.push(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3]));break;case'vt':m.uvs.push(parseFloat(v[1]),parseFloat(v[2]));}}else if('f'==p){for(var B,w=o.substr(1).trim(),x=w.split(/\s+/),y=[],z=0,A=x.length;z<A;z++)if(B=x[z],0<B.length){var C=B.split('/');y.push(C)}for(var D=y[0],z=1,A=y.length-1;z<A;z++){var E=y[z],F=y[z+1];m.addFace(D[0],E[0],F[0],D[1],E[1],F[1],D[2],E[2],F[2])}}else if('l'==p){var G=o.substring(1).trim().split(' '),H=[],I=[];if(-1===o.indexOf('/'))H=G;else for(var L,J=0,K=G.length;J<K;J++)L=G[J].split('/'),''!==L[0]&&H.push(L[0]),''!==L[1]&&I.push(L[1]);m.addLineGeometry(H,I)}else if('p'==p){var w=o.substr(1).trim(),M=w.split(' ');m.addPointGeometry(M)}else if(null!==(r=f.exec(o))){var N=(' '+r[0].substr(1).trim()).substr(1);m.startObject(N)}else if(h.test(o))m.object.startMaterial(o.substring(7).trim(),m.materialLibraries);else if(g.test(o))m.materialLibraries.push(o.substring(7).trim());else if('s'==p){if(r=o.split(' '),1<r.length){var O=r[1].trim().toLowerCase();m.object.smooth='0'!==O&&'off'!==O}else m.object.smooth=!0;var P=m.object.currentMaterial();P&&(P.smooth=m.object.smooth)}else{if('\0'==o)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+o+'"')}m.finalize();var Q=new THREE.Group;Q.materialLibraries=[].concat(m.materialLibraries);for(var t=0,u=m.objects.length;t<u;t++){var R=m.objects[t],S=R.geometry,T=R.materials,U='Line'===S.type,V='Points'===S.type,W=!1;if(0!==S.vertices.length){var X=new THREE.BufferGeometry;X.addAttribute('position',new THREE.Float32BufferAttribute(S.vertices,3)),0<S.normals.length?X.addAttribute('normal',new THREE.Float32BufferAttribute(S.normals,3)):X.computeVertexNormals(),0<S.colors.length&&(W=!0,X.addAttribute('color',new THREE.Float32BufferAttribute(S.colors,3))),0<S.uvs.length&&X.addAttribute('uv',new THREE.Float32BufferAttribute(S.uvs,2));for(var Y=[],Z=0,$=T.length;Z<$;Z++){var _=T[Z],P=void 0;if(null!==this.materials)if(P=this.materials.create(_.name),U&&P&&!(P instanceof THREE.LineBasicMaterial)){var aa=new THREE.LineBasicMaterial;aa.copy(P),aa.lights=!1,P=aa}else if(V&&P&&!(P instanceof THREE.PointsMaterial)){var ba=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});aa.copy(P),P=ba}P||(P=U?new THREE.LineBasicMaterial:V?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial,P.name=_.name),P.flatShading=!_.smooth,P.vertexColors=W?THREE.VertexColors:THREE.NoColors,Y.push(P)}var ca;if(1<Y.length){for(var _,Z=0,$=T.length;Z<$;Z++)_=T[Z],X.addGroup(_.groupStart,_.groupCount,Z);ca=U?new THREE.LineSegments(X,Y):V?new THREE.Points(X,Y):new THREE.Mesh(X,Y)}else ca=U?new THREE.LineSegments(X,Y[0]):V?new THREE.Points(X,Y[0]):new THREE.Mesh(X,Y[0]);ca.name=R.name,Q.add(ca)}}return console.timeEnd('OBJLoader'),Q}},e}();